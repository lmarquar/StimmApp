<!DOCTYPE html>
<html lang="de">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Konto löschen - StimmApp</title>
	<style>
		body {
			font-family: sans-serif;
			line-height: 1.6;
			max-width: 800px;
			margin: 0 auto;
			padding: 20px;
			color: #333;
		}

		h1 {
			color: #2c3e50;
		}

		.warning {
			color: #e74c3c;
			font-weight: bold;
			margin-top: 20px;
		}

		.form-group {
			margin-bottom: 15px;
		}

		label {
			display: block;
			margin-bottom: 5px;
			font-weight: bold;
		}

		input {
			width: 100%;
			padding: 8px;
			box-sizing: border-box;
			border: 1px solid #ccc;
			border-radius: 4px;
		}

		button {
			background-color: #e74c3c;
			color: white;
			padding: 10px 15px;
			border: none;
			border-radius: 4px;
			cursor: pointer;
			font-size: 16px;
		}

		button:hover {
			background-color: #c0392b;
		}

		button:disabled {
			background-color: #ccc;
			cursor: not-allowed;
		}

		.error {
			color: #e74c3c;
			background-color: #fadbd8;
			padding: 10px;
			border-radius: 4px;
			margin-bottom: 15px;
			display: none;
		}
	</style>
</head>

<body>
	<div id="content">
		<h1>Löschen Ihres StimmApp-Kontos</h1>
		<p>Bitte melden Sie sich an, um Ihr Konto und alle zugehörigen Daten unwiderruflich zu löschen.</p>

		<div id="error-message" class="error"></div>

		<form id="delete-form">
			<div class="form-group">
				<label for="email">E-Mail</label>
				<input type="email" id="email" required>
			</div>
			<div class="form-group">
				<label for="password">Passwort</label>
				<input type="password" id="password" required>
			</div>
			<p class="warning">Hinweis: Die Löschung Ihres Kontos ist endgültig und kann nicht rückgängig gemacht
				werden.</p>
			<button type="submit" id="delete-btn">Konto unwiderruflich löschen</button>
		</form>
	</div>

	<div id="success-message" style="display: none; text-align: center;">
		<h1>Konto gelöscht</h1>
		<p>Ihr Konto wurde erfolgreich gelöscht. Wir bedauern, dass Sie uns verlassen.</p>
	</div>

	<script type="module">
		import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
		import { getAuth, signInWithEmailAndPassword, deleteUser } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

		// TODO: Ersetzen Sie dies durch Ihre Firebase-Konfiguration
		// Sie finden diese in der Firebase Console unter Projekteinstellungen > Allgemein > Ihre Apps > SDK-Einrichtung und Konfiguration
		const firebaseConfig = {
			apiKey: "AIzaSyD8neBcTS2fkkRJf_GG-l4hD5dGArstQW8",
			authDomain: "stimmapp-f0141.firebaseapp.com",
			projectId: "stimmapp-f0141",
			storageBucket: "stimmapp-f0141.appspot.com",
			messagingSenderId: "223242419578",
			appId: "1:223242419578:web:5c0bac160b62f35888aac3"
		};

		const app = initializeApp(firebaseConfig);
		const auth = getAuth(app);

		const form = document.getElementById('delete-form');
		const emailInput = document.getElementById('email');
		const passwordInput = document.getElementById('password');
		const deleteBtn = document.getElementById('delete-btn');
		const errorMessage = document.getElementById('error-message');
		const contentDiv = document.getElementById('content');
		const successDiv = document.getElementById('success-message');

		form.addEventListener('submit', async (e) => {
			e.preventDefault();
			errorMessage.style.display = 'none';
			deleteBtn.disabled = true;
			deleteBtn.textContent = 'Wird gelöscht...';

			const email = emailInput.value;
			const password = passwordInput.value;

			try {
				const userCredential = await signInWithEmailAndPassword(auth, email, password);
				const user = userCredential.user;
				await deleteUser(user);

				contentDiv.style.display = 'none';
				successDiv.style.display = 'block';
			} catch (error) {
				console.error("Error deleting account:", error);
				errorMessage.textContent = "Fehler: " + getErrorMessage(error.code);
				errorMessage.style.display = 'block';
				deleteBtn.disabled = false;
				deleteBtn.textContent = 'Konto unwiderruflich löschen';
			}
		});

		function getErrorMessage(code) {
			switch (code) {
				case 'auth/invalid-credential':
				case 'auth/wrong-password':
				case 'auth/user-not-found':
					return "E-Mail oder Passwort ist falsch.";
				case 'auth/too-many-requests':
					return "Zu viele Versuche. Bitte versuchen Sie es später erneut.";
				default:
					return "Ein unbekannter Fehler ist aufgetreten (" + code + ").";
			}
		}
	</script>
</body>

</html>